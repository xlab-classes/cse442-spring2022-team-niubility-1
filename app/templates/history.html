<!doctype html>

<html>

<head>
  <title>History</title>

  <!--
Assignment: CSE442 project home page
Author: Niubility
Date: Feb. 27th, 2022 file was last edited
Editor:  BBEdit
-->
  <meta name="description" content="history">
  <meta name="author" content="Niubility">
  <meta name="keywords" content="HTML, CSS, JavaScript">
  <meta name="generator" content="BBEdit">
    <meta charset="utf-8">
{#  <meta charset="UTF-8" />#}

  <link href="CSE442.css" rel="stylesheet" />

  <style>
    * {
      margin: 0;
      padding: 0;
      background-color: #f7ecbc;
    }

    .container {
      position: relative;
    }

    .history {
      position: absolute;
      z-index: 1;
      top: 0;
      left: 10%;
    }

    .button {
		color: black;
		padding: 10px 22px;
		text-align: center;
		text-decoration: none;
		font-size: 19px;
		margin: 4px 2px;
		box-shadow: 2px 2px 4px #000000;
		width: 100%;
		}

    table {
      vertical-align: top;
      text-align: center;
    }

    tr {
      height: 30px;
      background-color: white;
      color: black;
    }

    th {
      background-color: #cf7e38;
      color: black;
      font-size: 24px;
    }

    table,
    th,
    td {
      border: 1px solid black;
    }

    .header {
      width: 80%;
      margin: 0 auto;
      height: 50px;
      border-bottom: 1px solid #000;
    }
    .header-tit{
      margin-top: 13px;
    }
    .header-tit img{
      width: 20px;
      height: 20px;
      margin-right: 5px;
    }
    .arrow{
      display: inline-block;
    }
    .btnDown {
      position: relative;
      float: right;
      min-width: 30px;
    }

    .clear::after {
      content: '';
      clear: both;
      display: block;
    }

    {#.active {#}
    {#  transform:rotateX(180deg);#}
    {#}#}
    ul{
      list-style: none;
    }
    .downList{
      position:absolute;
      top: 40px;
      z-index: 2;
      border: 1px solid #999;
    }
    .downList li{
      padding: 10px;
      white-space: nowrap;
      background-color: #fff;
      border-bottom: 1px solid #999;
    }
    .downList li:last-child{
      border-bottom:none;
    }
    a{
      text-decoration: none;
    }
    .bigtitle{
		text-align: center; 
		font-family:Arial, Helvetica, sans-serif; 
		font-size:50px;
		background-color: #e6ad4c;
		}
		.ttlayout{
		margin: 3% auto;
		padding: 10px 0px 10px 0px;
		background-color: #f2cc8a;
		}
		
		
  </style>
</head>

<body>
  <div class="header">
    <div class="btnDown clear">
        {% if current_user.username %}
              <div class="header-tit" onclick="login()">
                <img src="/static/logo1.png" alt=""  width="100px" height="100px">
                <span class="arrow active" style="margin-right: 50px"><a href="/">{{ current_user.username }}</a></span>
              <a HREF="/accounts/logout">log out</a>

              </div>

              <ul class="downList" style="display: none;" id="login">
{#                <li><a HREF="/">{{ request.user.username }}</a></li>#}
                <li></li>
              </ul>
        {% else %}
            <div class="header-tit" onclick="login()">
                <img src="/static/logo.png" alt="" width="100px" height="100px">
                <span class="arrow active"><a HREF="/accounts/login">login</a></span>
              </div>
             <ul class="downList" style="display: none;" id="login">
                <li><a HREF="/accounts/login">login</a></li>
                <li><a HREF="/accounts/logout">register</a></li>
              </ul>
        {% endif %}

    </div>
  </div>
  
  <div class="ttlayout">
  <h1 class="bigtitle">Task History</h1>
  </div>
  
  <div class="container">
    <div class="history">
      <div class="box">
        <a HREF="/add_task"><button class="button">Add Task</button></a>
      </div>
      <div class="box">
        <a HREF="/history"><button class="button">View History</button></a>
      </div>
        <div class="box">
        <a HREF="/index"><button class="button">Home Page</button></a>
      </div>
    </div>
    <table class="schedule" , style="width: 54%;margin-left:auto;margin-right:auto">
      <col style="width:16%">
      <col style="width:12%">
      <col style="width:12%">
      <col style="width:12%">
      <col style="width:12%">
      <thead>
        <tr>
          <th>name</th>
          <th>time</th>
          <th>priority</th>
          <th>description</th>
          <th>operation</th>
        </tr>
      </thead>
      <tbody>
      {% for task in all_task %}
          <tr>
              <th>
                  {{ task.name }}
              </th>
              <td>{{ task.begin }} {{ task.begin_time }}</td>
              <td>{{ task.priority }}</td>
              {% if task.description %}
                  <td>{{ task.description }}</td>
              {% else %}
                  <td>no description！</td>
              {% endif %}
              <td><button class="button" onclick="delete1('{{ task.id }}')">Delete</button></td>
            </tr>
      {% endfor %}


      </tbody>

    </table>

  </div>
  <script src="/static/jquery.min.js"></script>
  <script>
      function delete1(wid){
          $.ajax({
                      type: 'POST',
                      url: '/delete_task',
                      data: JSON.stringify({"id":wid}),
                      dataType: "json",
                      contentType: 'application/json;charset=utf-8',
                      success: function(data) {
                          alert(data.data)
                          location.reload();
                      },
                      error: function(xhr) {
                            //中间发生异常，查看xhr.responseText
                          alert("system error")
                      }
                    });
      }
  </script>
  <script>
    function login(){
      var login = document.getElementById('login');
      if(login.style.display == 'block'){
        login.style.display = 'none'
      }else{
        login.style.display = 'block'
      }
      
    }
  </script>
</body>

</html>